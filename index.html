<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hin√°rio Ubuntu</title>

<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&family=Nunito:wght@600;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#FFC72C;
  --bg:#0a0a0a;
  --bg2:#1a1a1a;
  --card:#2a2a2a;
  --text:#ffffff;
  --accent:#FFC72C;
  --font:16px;
}
.light{
  --bg:#f4f4f4;
  --bg2:#ffffff;
  --card:#e6e6e6;
  --text:#111111;
  --accent:#333333;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:linear-gradient(135deg,var(--bg),var(--bg2));
  color:var(--text);
  font-family:'Crimson Text',serif;
  font-size:var(--font);
}

/* HEADER PRINCIPAL */
header{
  padding:1.2rem 1.5rem;
  border-bottom:3px solid var(--primary);
}
.header-wrapper{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:.6rem;
}
.header-top{
  display:flex;
  align-items:center;
  gap:.8rem;
}
header img{width:52px;height:52px;flex-shrink:0}
h1{
  font-family:'Nunito',sans-serif;
  font-size:1.7rem;
  font-weight:700;
  white-space:nowrap;
}
.controls{
  display:flex;
  gap:1rem;
  justify-content:center;
}
.controls button{
  background:none;
  border:none;
  color:var(--accent);
  font-size:1.3rem;
  cursor:pointer;
}

.search{padding:1rem 1.5rem}
.search input{
  width:100%;
  padding:.8rem 1rem;
  border-radius:10px;
  border:none;
}

.container{max-width:900px;margin:1.5rem auto;padding:0 1rem}

.playlist-launch{
  display:flex;
  justify-content:flex-end;
  margin-bottom:1rem;
}
.playlist-launch button{
  background:var(--card);
  border:2px solid var(--primary);
  color:var(--accent);
  padding:.5rem .8rem;
  border-radius:8px;
  font-weight:bold;
}

.card{
  background:var(--card);
  padding:1rem;
  border-radius:10px;
  margin-bottom:1rem;
  cursor:pointer;
}
.card:hover{outline:2px solid var(--primary)}
.num{
  background:var(--primary);
  color:#000;
  padding:.2rem .6rem;
  border-radius:6px;
  font-weight:bold;
  margin-right:.5rem;
}

/* OVERLAY DO HINO */
.overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  overflow:auto;
  z-index:10;
}
.overlay.active{display:block}

.detail{
  background:var(--card);
  max-width:900px;
  margin:2rem auto;
  padding:2rem;
  border-radius:15px;
}

.detail-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:1rem;
}
.detail-header .back{
  color:var(--accent);
  font-weight:bold;
  cursor:pointer;
}
.detail-controls button{
  background:none;
  border:none;
  color:var(--accent);
  font-size:1.2rem;
  margin-left:.5rem;
  cursor:pointer;
}

.lyrics{
  white-space:pre-wrap;
  line-height:1.8;
  margin:1.5rem 0;
}

audio{width:100%;margin-top:1rem}

.download-btn{
  display:block;
  margin:1.2rem 0;
  color:var(--accent);
  font-weight:bold;
  text-decoration:none;
}


</style>
</head>

<body>

<header>
  <div class="header-wrapper">
    <div class="header-top">
      <img src="https://i.imgur.com/4aZvsOD.png">
      <h1>Hin√°rio Ubuntu</h1>
    </div>
    <div class="controls">
      <button onclick="toggleTheme()">üåô</button>
      <button onclick="font(-1)">A-</button>
      <button onclick="font(1)">A+</button>
    </div>
  </div>
</header>

<div class="search">
  <input id="search" placeholder="Buscar hino por n√∫mero ou t√≠tulo...">
</div>

<div class="container">
  <div class="playlist-launch">
    <button onclick="openPlaylist()">‚ñ∂ Playlist</button>
  </div>
  <div id="list">Carregando hinos‚Ä¶</div>
</div>

<div class="overlay" id="playlistOverlay">
  <div class="detail">
    <div class="detail-header">
      <span class="back" onclick="closePlaylist()">‚Üê Voltar ao √≠ndice</span>
      <div class="detail-controls">
        <button onclick="font(-1)">A-</button>
        <button onclick="font(1)">A+</button>
      </div>
    </div>
    <h2>‚ñ∂ Playlist</h2>
    <div style="margin:1rem 0;display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem;max-width:360px">
      <button onclick="plPrev()" style="background:var(--card);border:2px solid var(--primary);color:var(--accent);padding:.5rem;border-radius:8px;font-size:1.2rem;cursor:pointer">‚èÆ</button>
      <button onclick="plPlay()" id="plPlayBtn" style="background:var(--primary);border:none;color:#000;padding:.5rem;border-radius:8px;font-size:1.2rem;font-weight:bold;cursor:pointer">‚ñ∂</button>
      <button onclick="plStop()" style="background:var(--card);border:2px solid var(--primary);color:var(--accent);padding:.5rem;border-radius:8px;font-size:1.2rem;cursor:pointer">‚èπ</button>
      <button onclick="plNext()" style="background:var(--card);border:2px solid var(--primary);color:var(--accent);padding:.5rem;border-radius:8px;font-size:1.2rem;cursor:pointer">‚è≠</button>
    </div>
    <div id="plNowPlaying" style="margin-bottom:1.2rem;font-weight:bold;font-size:1.1rem;line-height:1.5"></div>
    <audio id="plPlayer" controls style="width:100%;margin-bottom:.5rem"></audio>
    <span class="back" style="display:block;margin-top:1.5rem;color:var(--accent);font-weight:bold;cursor:pointer" onclick="closePlaylist()">‚Üê Voltar ao √≠ndice</span>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="detail">
    <div class="detail-header">
      <span class="back" onclick="closeDetail()">‚Üê Voltar ao √≠ndice</span>
      <div class="detail-controls">
        <button onclick="font(-1)">A-</button>
        <button onclick="font(1)">A+</button>
      </div>
    </div>
    <h2><span id="dnum"></span> ‚Äì <span id="dtitle"></span></h2>
    <div class="lyrics" id="dlyrics"></div>
    <audio id="player" controls style="display:none"></audio>
    <span class="back" style="display:block;margin-top:1.5rem;color:var(--accent);font-weight:bold;cursor:pointer" onclick="closeDetail()">‚Üê Voltar ao √≠ndice</span>
    <a id="downloadLink" class="download-btn" download style="display:none">‚¨áÔ∏è Baixar √°udio</a>
  </div>
</div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRMmvd1DczfnoyH1TzT0eqjCoSw1dkYXMKKcpO5_NbfHJ-d3bDQjlLOJtBk_EwKsiXoq3gGqUC854KC/pub?gid=0&single=true&output=csv";

let hymns=[],size=16;

function font(d){
  size=Math.min(26,Math.max(12,size+d));
  document.documentElement.style.setProperty('--font',size+'px');
}
function toggleTheme(){document.body.classList.toggle('light')}

function parseCSV(t){
  const r=[];let row=[],f='',q=false;
  for(let i=0;i<t.length;i++){
    const c=t[i],n=t[i+1];
    if(c=='"'){q&&n=='"'?(f+='"',i++):q=!q}
    else if(c==','&&!q){row.push(f);f=''}
    else if((c=='\n'||c=='\r')&&!q){
      if(f||row.length){row.push(f);r.push(row)}
      row=[];f='';if(c=='\r'&&n=='\n')i++
    } else f+=c;
  }
  if(f||row.length){row.push(f);r.push(row)}
  return r.slice(1).map(x=>({num:x[0],title:x[1],lyrics:x[2],audio:x[3]}));
}

function render(l){
  list.innerHTML='';
  l.forEach(h=>{
    const d=document.createElement('div');
    d.className='card';
    d.innerHTML='<span class="num">'+h.num+'</span>'+h.title;
    d.onclick=()=>open(h);
    list.appendChild(d);
  });
}

function open(h){
  dnum.textContent=h.num;
  dtitle.textContent=h.title;
  dlyrics.textContent=h.lyrics||'';
  if(h.audio){
    player.src=h.audio;
    player.style.display='block';
    downloadLink.href=h.audio;
    downloadLink.style.display='block';
  } else {
    player.style.display='none';
    downloadLink.style.display='none';
  }
  overlay.classList.add('active');
}
function closeDetail(){
  player.pause();player.src='';
  overlay.classList.remove('active');
}

fetch(CSV_URL).then(r=>r.text()).then(t=>{
  hymns=parseCSV(t);
  render(hymns);
});
// PLAYLIST
let plIndex=0,plAudio=document.getElementById('plPlayer');

function openPlaylist(){
  const withAudio=hymns.filter(h=>h.audio);
  plIndex=0;
  plLoadTrack(withAudio);
  document.getElementById('playlistOverlay').classList.add('active');
  plAudio.onended=()=>{plNext();};
  plAudio._withAudio=withAudio;
}

function plLoadTrack(list){
  const h=list[plIndex];
  plAudio.src=h.audio;
  document.getElementById('plNowPlaying').innerHTML='‚ô™ Tocando agora:<br>'+h.num+' ‚Äì '+h.title;
}

function plLoadAndPlay(list){
  plLoadTrack(list);
  plAudio.play();
  document.getElementById('plPlayBtn').textContent='‚è∏';
}

function plPlay(){
  const list=plAudio._withAudio;
  if(!list) return;
  if(plAudio.paused){
    plAudio.play();
    document.getElementById('plPlayBtn').textContent='‚ñ∂';
  } else {
    plAudio.pause();
    document.getElementById('plPlayBtn').textContent='‚è∏';
  }
}

function plStop(){
  plAudio.pause();
  plAudio.currentTime=0;
  document.getElementById('plPlayBtn').textContent='‚ñ∂';
}

function plNext(){
  const list=plAudio._withAudio;
  if(!list) return;
  plIndex=(plIndex+1)%list.length;
  plLoadAndPlay(list);
}

function plPrev(){
  const list=plAudio._withAudio;
  if(!list) return;
  plIndex=(plIndex-1+list.length)%list.length;
  plLoadAndPlay(list);
}

function closePlaylist(){
  plAudio.pause();plAudio.src='';
  document.getElementById('plPlayBtn').textContent='‚ñ∂ Play';
  document.getElementById('playlistOverlay').classList.remove('active');
}

search.oninput=e=>{
  const v=e.target.value.toLowerCase();
  render(hymns.filter(h=>h.num.includes(v)||h.title.toLowerCase().includes(v)));
};
</script>

</body>
</html>

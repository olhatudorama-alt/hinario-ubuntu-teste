<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hin√°rio Ubuntu</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#FFC72C;
  --bg:#0a0a0a;
  --card:#2a2a2a;
  --text:#fff;
  --font:16px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:linear-gradient(135deg,#0a0a0a,#1a1a1a);
  color:var(--text);
  font-family:'Crimson Text',serif;
  font-size:var(--font);
}
header{
  display:flex;
  align-items:center;
  gap:1rem;
  padding:1.2rem 1.5rem;
  border-bottom:3px solid var(--primary);
}
header img{width:72px;height:72px}
h1{
  font-family:'Playfair Display',serif;
  font-size:2.3rem;
  flex:1;
}
.controls button{
  background:none;border:none;color:var(--primary);
  font-size:1.2rem;cursor:pointer;margin-left:.5rem;
}
.search{padding:1rem 1.5rem}
.search input{
  width:100%;padding:.8rem 1rem;border-radius:10px;border:none;font-size:1rem;
}
.container{max-width:900px;margin:1.5rem auto;padding:0 1rem}

.playlist-box{
  background:var(--card);
  border-radius:12px;
  padding:1rem;
  margin-bottom:1.5rem;
}
.playlist-box h3{
  margin-bottom:.8rem;
}
.playlist-box button{
  background:var(--primary);
  border:none;
  padding:.6rem 1rem;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
.playlist-box audio{
  width:100%;
  margin-top:.8rem;
}

.card{
  background:var(--card);padding:1rem;border-radius:10px;margin-bottom:1rem;cursor:pointer
}
.card:hover{outline:2px solid var(--primary)}
.num{
  background:var(--primary);color:#000;padding:.2rem .6rem;
  border-radius:6px;font-weight:bold;margin-right:.5rem
}
.overlay{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);overflow:auto
}
.overlay.active{display:block}
.detail{
  background:var(--card);max-width:900px;margin:2rem auto;
  padding:2rem;border-radius:15px
}
.back{
  color:var(--primary);font-weight:bold;cursor:pointer;margin:1rem 0;display:inline-block
}
.lyrics{white-space:pre-wrap;line-height:1.8;margin:1.5rem 0}
audio{width:100%;margin-top:1.5rem}
.download-btn{
  display:inline-block;
  margin-top:.6rem;
  color:var(--primary);
  font-weight:bold;
  text-decoration:none;
}
</style>
</head>

<body>

<header>
  <img src="https://i.imgur.com/4aZvsOD.png" alt="Logo">
  <h1>Hin√°rio Ubuntu</h1>
  <div class="controls">
    <button onclick="font(-1)">A-</button>
    <button onclick="font(1)">A+</button>
  </div>
</header>

<div class="search">
  <input id="search" placeholder="Buscar hino por n√∫mero ou t√≠tulo...">
</div>

<div class="container">

  <div class="playlist-box">
    <h3>üéß Tocar todos os hinos</h3>
    <button onclick="startPlaylist()">‚ñ∂Ô∏è Iniciar playlist</button>
    <audio id="playlistPlayer" controls></audio>
  </div>

  <div id="list">Carregando hinos‚Ä¶</div>
</div>

<div class="overlay" id="overlay">
  <div class="detail">
    <div class="back" onclick="closeDetail()">‚Üê Voltar ao √≠ndice</div>
    <h2><span id="dnum"></span> ‚Äì <span id="dtitle"></span></h2>
    <div class="lyrics" id="dlyrics"></div>
    <audio id="player" controls style="display:none"></audio>
    <a id="downloadLink" class="download-btn" href="#" download style="display:none">‚¨áÔ∏è Baixar √°udio</a>
    <div class="back" onclick="closeDetail()">‚Üê Voltar ao √≠ndice</div>
  </div>
</div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRMmvd1DczfnoyH1TzT0eqjCoSw1dkYXMKKcpO5_NbfHJ-d3bDQjlLOJtBk_EwKsiXoq3gGqUC854KC/pub?gid=0&single=true&output=csv";

let hymns=[],size=16,playlist=[],currentIndex=0;

function font(d){
  size=Math.min(26,Math.max(12,size+d));
  document.documentElement.style.setProperty('--font',size+'px');
}

function parseCSV(t){
  const r=[];let row=[],f='',q=false;
  for(let i=0;i<t.length;i++){
    const c=t[i],n=t[i+1];
    if(c=='"'){q&&n=='"'?(f+='"',i++):q=!q}
    else if(c==','&&!q){row.push(f);f=''}
    else if((c=='\n'||c=='\r')&&!q){
      if(f||row.length){row.push(f);r.push(row)}
      row=[];f='';if(c=='\r'&&n=='\n')i++
    } else f+=c;
  }
  if(f||row.length){row.push(f);r.push(row)}
  return r.slice(1).map(x=>({num:x[0],title:x[1],lyrics:x[2],audio:x[3]}));
}

function render(l){
  list.innerHTML='';
  l.forEach(h=>{
    const d=document.createElement('div');
    d.className='card';
    d.innerHTML='<span class="num">'+h.num+'</span>'+h.title;
    d.onclick=()=>open(h);
    list.appendChild(d);
  });
}

function open(h){
  dnum.textContent=h.num;
  dtitle.textContent=h.title;
  dlyrics.textContent=h.lyrics||'';
  if(h.audio){
    player.src=h.audio;
    player.style.display='block';
    downloadLink.href=h.audio;
    downloadLink.style.display='inline-block';
  } else {
    player.style.display='none';
    downloadLink.style.display='none';
    player.src='';
  }
  overlay.classList.add('active');
}

function closeDetail(){
  player.pause(); player.src='';
  overlay.classList.remove('active');
}

function startPlaylist(){
  playlist=hymns.filter(h=>h.audio);
  if(!playlist.length) return;
  currentIndex=0;
  playlistPlayer.src=playlist[0].audio;
  playlistPlayer.play();
}

playlistPlayer.addEventListener('ended',()=>{
  currentIndex++;
  if(currentIndex<playlist.length){
    playlistPlayer.src=playlist[currentIndex].audio;
    playlistPlayer.play();
  }
});

fetch(CSV_URL).then(r=>r.text()).then(t=>{
  hymns=parseCSV(t);
  render(hymns);
});

search.oninput=e=>{
  const v=e.target.value.toLowerCase();
  render(hymns.filter(h=>h.num.includes(v)||h.title.toLowerCase().includes(v)));
};
</script>

</body>
</html>
